# API for check logs by black list and Geoip

This API is written in python3 and use Flask. It's created by cybersecurity service of ANS ["Agence Numérique Santé" -> "Digital Health Agency"](https://cyberveille-sante.gouv.fr/). It's help you in analyse big log file contains IP v4 addresses.  It extract address ip from line and compare to bl and geoip (if you use option geoip).

## Require
  - [docker](https://docs.docker.com/install/) & [docker compose](https://docs.docker.com/compose/)
  - [Register and download Geoip2 lite Country database in binary MMDB format](https://dev.maxmind.com/geoip/geoip2/geolite2/#Database)
  - Black list generated by script create-ipbl.py (generate_bl of this git repository)
## Let's Start
  - build docker image: docker-compose build
  - Copy Geoip2 lite country database in same path of docker with filename: GeoLite2-Country.mmdb
  - Configure docker-compose.yml (verify fields "volumes:" and change if need & you can log docker by syslog)
  - Put your API key in app/api.key
  - Run Api: docker-compose up -d

## Use API REST
  - Run commande curl: curl -k  -F 'file=@suspect.log' -F 'geoip=FR' -H "x-api-key: APIKEY" https://127.0.0.1:8000/api/check_bl_on_log | gzip -d | python -m json.tool > result.json
    - you can send compressed file (gzip) => -F 'file=@suspect.log.gz'
    - The field 'geoip' is optional, you can use for filter by Country. By exemple: "geoip=FR" will return all line in file with IP not from France.
  - Result in Json format is compressed (gzip). Below the fields in the result:
    - 'file_clean'
    - 'GeoIP' (GeoIP different of you country code matched)
      - {IP:Country_Code}
    - 'BL' (IP BL list)
      - {IP:BL_List_matched}
    - 'lines_suspect' (line match to BL or/and GeoIP)
      - {Number_of_Line: Line, BL: Match True or False, geoip: Country_Code}
    
## Exemple to use context
  - Log from VPN/Webmaib: check GEOIP acces and BL to find suspects with successful connections
  - Log from proxy web: check BL to find suspects connections (BOTNET...)
  - Log from web server: check BL to find suspects connections (web attack...)

